# üìä Inventory Overview Graph - Complete Documentation

## üì∏ Graph Overview

![Inventory Overview Graph](../path/to/screenshot.png)

**Location:** Dashboard Page ‚Üí Top Section  
**Component Name:** Inventory Overview Bar Chart  
**Purpose:** Displays sales trends and AI predictions over time  
**Update Frequency:** Live (updates every 60 seconds)

---

## üéØ What This Graph Shows

### **Visual Elements:**

1. **Blue Bars (Darker)** - `#2563eb`
   - **Label:** "AI Predicted Demand (‚Çπ)"
   - **Data:** Predicted sales values generated by AI
   - **Purpose:** Shows what the system forecasts for demand

2. **Gray Bars (Lighter)** - `#cbd5e1`
   - **Label:** "Actual Sales (‚Çπ)"
   - **Data:** Real sales transactions from stock-out records
   - **Purpose:** Shows actual historical sales

3. **X-Axis (Horizontal)**
   - **Data:** Dates in format `YYYY-MM-DD` (e.g., 2026-01-10)
   - **Range:** Last 7 days by default
   - **Format:** Date labels shown below each bar

4. **Y-Axis (Vertical)**
   - **Data:** Sales value in Rupees (‚Çπ)
   - **Range:** Auto-scaled from 0 to max value
   - **Format:** Numeric values (e.g., 0, 45000, 90000, 135000, 180000)

---

## üé® Graph Features

### **Header Section:**
- **Title:** "Inventory Overview"
- **Depot Selector:** Dropdown to filter by specific depot or "Global Network"
- **Time Scale:** "Weekly Scale" selector (currently fixed)

### **Footer Section:**
- **Export Buttons:**
  - CSV ‚Üì - Export data as CSV
  - PDF ‚Üì - Export as PDF report
- **Live Indicator:** 
  - Green trending up icon
  - "Updated Live" text

### **Interactive Features:**
- **Hover Tooltip:** Shows exact values when hovering over bars
- **Responsive:** Adjusts to screen size
- **Auto-refresh:** Updates every 60 seconds

---

## üìÅ File Structure & Code Files

### **Frontend Files:**

| File Path | Purpose | Lines to Check |
|-----------|---------|----------------|
| `Frontend/src/pages/Dashboard.jsx` | Main dashboard component | Lines 69-129 |
| `Frontend/src/hooks/useDashboardData.js` | Data fetching logic | Lines 89-98 |
| `Frontend/src/utils/api.js` | API call functions | Check `getSalesTrend()` |

### **Backend Files:**

| File Path | Purpose | Lines to Check |
|-----------|---------|----------------|
| `Backend/server/routes/dashboard.js` | Sales trend API endpoint | Lines 94-129 |
| `Backend/server/models/Transaction.js` | Transaction data model | Full file |

---

## üîß Code Breakdown

### **1. Frontend Component (Dashboard.jsx)**

**Location:** Lines 69-129

```jsx
<div className="chart-section">
    <div className="section-header">
        <h3>Inventory Overview</h3>
        <div className="header-controls">
            {/* Depot Selector */}
            <select 
                className="card-select depot-switcher"
                value={selectedDepot}
                onChange={(e) => setSelectedDepot(e.target.value)}
            >
                <option value="all">Global Network</option>
                {depots.map(depot => (
                    <option key={depot._id} value={depot._id}>
                        {depot.name}
                    </option>
                ))}
            </select>
            
            {/* Time Scale Selector */}
            <select className="card-select">
                <option>Weekly Scale</option>
            </select>
        </div>
    </div>
    
    {/* Chart Container */}
    <div className="chart-container">
        {chartData && chartData.length > 0 ? (
            <ResponsiveContainer width="100%" height={350}>
                <BarChart data={chartData}>
                    <CartesianGrid 
                        strokeDasharray="3 3" 
                        vertical={false} 
                        stroke="var(--border)" 
                    />
                    <XAxis 
                        dataKey="name" 
                        axisLine={false} 
                        tickLine={false} 
                        tick={{ fill: 'var(--text-muted)', fontSize: 12 }} 
                    />
                    <YAxis 
                        axisLine={false} 
                        tickLine={false} 
                        tick={{ fill: 'var(--text-muted)', fontSize: 12 }} 
                    />
                    <Tooltip
                        cursor={{ fill: 'var(--bg-main)' }}
                        contentStyle={{
                            backgroundColor: 'var(--bg-card)',
                            borderColor: 'var(--border)',
                            borderRadius: '8px',
                            color: 'var(--text-main)'
                        }}
                    />
                    {/* Gray Bar - Actual Sales */}
                    <Bar 
                        dataKey="actual" 
                        fill="#cbd5e1" 
                        radius={[4, 4, 0, 0]} 
                        name="Actual Sales (‚Çπ)" 
                    />
                    {/* Blue Bar - AI Predictions */}
                    <Bar 
                        dataKey="predicted" 
                        fill="#2563eb" 
                        radius={[4, 4, 0, 0]} 
                        name="AI Predicted Demand (‚Çπ)" 
                    />
                </BarChart>
            </ResponsiveContainer>
        ) : (
            <div className="no-data-placeholder">
                <p>No sales transactions recorded yet</p>
                <p>Sales trend will appear once you record stock-out transactions</p>
            </div>
        )}
    </div>
    
    {/* Footer with Export Buttons */}
    <div className="chart-footer">
        <div className="footer-btns">
            <button className="export-btn">CSV ‚Üì</button>
            <button className="export-btn">PDF ‚Üì</button>
        </div>
        <div className="trend-stat">
            <TrendingUp size={14} className="positive" />
            <span className="positive">Updated Live</span>
        </div>
    </div>
</div>
```

**Key Props:**
- `chartData` - Array of data points from `useDashboardData` hook
- `selectedDepot` - Currently selected depot filter
- `depots` - List of all available depots

---

### **2. Data Hook (useDashboardData.js)**

**Location:** Lines 89-98

```javascript
// 5. Process Trend Data
if (trendRes && trendRes.trendData) {
    setChartData(trendRes.trendData.map(d => ({
        name: d.date,        // X-axis label (date)
        actual: d.sales || 0,     // Gray bar (actual sales)
        predicted: d.predicted || 0  // Blue bar (AI prediction)
    })));
} else if (trendRes && trendRes.status !== 'error') {
    setChartData([]);
}
```

**Data Flow:**
1. Calls `api.getSalesTrend()` every 60 seconds
2. Receives `trendData` array from backend
3. Maps to chart format with `name`, `actual`, `predicted`
4. Updates `chartData` state
5. Chart re-renders automatically

---

### **3. Backend API (dashboard.js)**

**Location:** Lines 94-129

```javascript
router.get('/sales-trend', async (req, res, next) => {
    try {
        const userId = req.userId;
        const { days = 7 } = req.query;  // Default 7 days

        // Calculate start date
        const startDate = new Date();
        startDate.setDate(startDate.getDate() - parseInt(days));

        // Fetch stock-out transactions
        const transactions = await Transaction.find({
            userId,
            timestamp: { $gte: startDate },
            transactionType: 'stock-out'  // Only sales transactions
        }).sort({ timestamp: 1 });

        // Group transactions by date
        const trendMap = {};
        transactions.forEach(tx => {
            const date = new Date(tx.timestamp)
                .toLocaleDateString('en-US', { 
                    month: 'short', 
                    day: 'numeric' 
                });
            
            if (!trendMap[date]) {
                trendMap[date] = { sales: 0, predicted: 0 };
            }
            
            // Sum up sales for the day
            trendMap[date].sales += tx.quantity;
            
            // Generate prediction (110% of actual)
            trendMap[date].predicted += tx.quantity * 1.1;
        });

        // Convert to array format
        const trendData = Object.keys(trendMap).map(date => ({
            date,
            sales: trendMap[date].sales,
            predicted: Math.round(trendMap[date].predicted)
        }));

        res.json({ trendData, transactions });
    } catch (error) {
        next(error);
    }
});
```

**API Response Format:**
```json
{
  "trendData": [
    {
      "date": "Jan 10",
      "sales": 175000,
      "predicted": 192500
    },
    {
      "date": "Jan 11",
      "sales": 150000,
      "predicted": 165000
    }
  ],
  "transactions": [...]
}
```

---

## üìä Data Source & Calculation

### **Where Data Comes From:**

1. **Database Collection:** `transactions`
2. **Filter Criteria:**
   - `userId` - Current logged-in user
   - `transactionType: 'stock-out'` - Only sales/outbound transactions
   - `timestamp` - Last 7 days (configurable)

3. **Aggregation:**
   - Groups transactions by date
   - Sums quantities for each day
   - Generates predictions (currently 110% of actual)

### **Data Transformation:**

```
MongoDB Transaction ‚Üí Backend Aggregation ‚Üí Frontend Mapping ‚Üí Chart Display
```

**Example:**
```
Transaction: { quantity: 50, timestamp: "2026-01-10" }
         ‚Üì
Backend: { date: "Jan 10", sales: 50, predicted: 55 }
         ‚Üì
Frontend: { name: "Jan 10", actual: 50, predicted: 55 }
         ‚Üì
Chart: Two bars at "Jan 10" - Gray (50) and Blue (55)
```

---

## üé® Styling & Colors

### **CSS Variables Used:**

```css
--border: #e5e7eb          /* Grid lines */
--text-muted: #6b7280      /* Axis labels */
--bg-main: #f9fafb         /* Tooltip cursor */
--bg-card: #ffffff         /* Tooltip background */
--text-main: #111827       /* Tooltip text */
```

### **Bar Colors:**

```css
Actual Sales: #cbd5e1     /* Slate-300 - Light gray */
Predicted: #2563eb        /* Blue-600 - Vibrant blue */
```

### **Chart Dimensions:**

```css
Width: 100% (responsive)
Height: 350px (fixed)
Border Radius: 4px (top corners of bars)
```

---

## üîÑ How to Make Changes

### **Change 1: Modify Time Range**

**File:** `Backend/server/routes/dashboard.js` (Line 97)

```javascript
// Current: 7 days
const { days = 7 } = req.query;

// Change to 30 days:
const { days = 30 } = req.query;
```

**Frontend Update:** `Frontend/src/utils/api.js`
```javascript
getSalesTrend: (days = 7) => 
    api.get(`/api/dashboard/sales-trend?days=${days}`)
```

---

### **Change 2: Modify Bar Colors**

**File:** `Frontend/src/pages/Dashboard.jsx` (Lines 104-105)

```jsx
{/* Change gray to green */}
<Bar dataKey="actual" fill="#10b981" ... />

{/* Change blue to purple */}
<Bar dataKey="predicted" fill="#8b5cf6" ... />
```

---

### **Change 3: Add More Bars**

**File:** `Frontend/src/pages/Dashboard.jsx` (After line 105)

```jsx
{/* Add a third bar for target */}
<Bar 
    dataKey="target" 
    fill="#f59e0b" 
    radius={[4, 4, 0, 0]} 
    name="Target Sales (‚Çπ)" 
/>
```

**Backend Update:** Add `target` to data
```javascript
trendMap[date] = { 
    sales: 0, 
    predicted: 0,
    target: 200000  // Fixed target
};
```

---

### **Change 4: Change Chart Type**

**File:** `Frontend/src/pages/Dashboard.jsx` (Line 91)

```jsx
{/* Change from BarChart to LineChart */}
import { LineChart, Line } from 'recharts';

<LineChart data={chartData}>
    <Line type="monotone" dataKey="actual" stroke="#cbd5e1" />
    <Line type="monotone" dataKey="predicted" stroke="#2563eb" />
</LineChart>
```

---

### **Change 5: Modify Prediction Algorithm**

**File:** `Backend/server/routes/dashboard.js` (Line 116)

```javascript
// Current: 110% of actual
trendMap[date].predicted += tx.quantity * 1.1;

// Change to: 120% of actual
trendMap[date].predicted += tx.quantity * 1.2;

// Or use moving average:
const avgSales = calculateMovingAverage(transactions);
trendMap[date].predicted = avgSales;
```

---

### **Change 6: Add Depot Filtering**

**File:** `Backend/server/routes/dashboard.js` (Line 102)

```javascript
// Add depot filter
const { depotId } = req.query;

const query = {
    userId,
    timestamp: { $gte: startDate },
    transactionType: 'stock-out'
};

// Add depot filter if provided
if (depotId && depotId !== 'all') {
    query.$or = [
        { fromDepotId: depotId },
        { toDepotId: depotId }
    ];
}

const transactions = await Transaction.find(query).sort({ timestamp: 1 });
```

**Frontend Update:** Pass depot to API
```javascript
// In useDashboardData.js
api.getSalesTrend(7, selectedDepot)
```

---

## üêõ Common Issues & Fixes

### **Issue 1: Graph Shows "No Data"**

**Cause:** No stock-out transactions in database

**Fix:**
1. Check if transactions exist:
   ```javascript
   db.transactions.find({ transactionType: 'stock-out' })
   ```
2. Create test transactions via UI or API
3. Verify date range includes transactions

---

### **Issue 2: Bars Not Showing**

**Cause:** Data format mismatch

**Fix:**
1. Check `chartData` in browser console:
   ```javascript
   console.log('chartData:', chartData);
   ```
2. Verify format:
   ```javascript
   [{ name: "Jan 10", actual: 100, predicted: 110 }]
   ```
3. Check dataKey matches: `actual` and `predicted`

---

### **Issue 3: Tooltip Not Working**

**Cause:** CSS variable not defined

**Fix:**
1. Add CSS variables to your stylesheet:
   ```css
   :root {
       --bg-card: #ffffff;
       --border: #e5e7eb;
       --text-main: #111827;
   }
   ```

---

### **Issue 4: Depot Filter Not Working**

**Cause:** Backend not filtering by depot

**Fix:**
1. Add depot filter to backend query (see Change 6 above)
2. Pass `selectedDepot` to API call
3. Verify query in backend logs

---

### **Issue 5: Dates Not Showing**

**Cause:** Date format issue

**Fix:**
1. Check date format in backend:
   ```javascript
   const date = new Date(tx.timestamp)
       .toLocaleDateString('en-US', { 
           month: 'short', 
           day: 'numeric',
           year: 'numeric'  // Add year if needed
       });
   ```

---

## üìà Performance Optimization

### **1. Caching**

Add Redis caching for trend data:

```javascript
// Backend
const redis = require('redis');
const client = redis.createClient();

router.get('/sales-trend', async (req, res) => {
    const cacheKey = `trend:${userId}:${days}`;
    
    // Check cache first
    const cached = await client.get(cacheKey);
    if (cached) {
        return res.json(JSON.parse(cached));
    }
    
    // ... fetch from database ...
    
    // Cache for 5 minutes
    await client.setex(cacheKey, 300, JSON.stringify(result));
    res.json(result);
});
```

---

### **2. Pagination**

For large datasets, paginate results:

```javascript
const { page = 1, limit = 7 } = req.query;
const skip = (page - 1) * limit;

const transactions = await Transaction.find(query)
    .sort({ timestamp: 1 })
    .skip(skip)
    .limit(limit);
```

---

### **3. Aggregation Pipeline**

Use MongoDB aggregation for better performance:

```javascript
const trendData = await Transaction.aggregate([
    {
        $match: {
            userId: mongoose.Types.ObjectId(userId),
            timestamp: { $gte: startDate },
            transactionType: 'stock-out'
        }
    },
    {
        $group: {
            _id: {
                $dateToString: { 
                    format: "%Y-%m-%d", 
                    date: "$timestamp" 
                }
            },
            sales: { $sum: "$quantity" }
        }
    },
    {
        $project: {
            date: "$_id",
            sales: 1,
            predicted: { $multiply: ["$sales", 1.1] }
        }
    },
    { $sort: { date: 1 } }
]);
```

---

## üß™ Testing

### **Unit Tests:**

```javascript
// Test data transformation
describe('Sales Trend Data', () => {
    it('should transform transactions to chart data', () => {
        const transactions = [
            { timestamp: '2026-01-10', quantity: 100 },
            { timestamp: '2026-01-10', quantity: 50 }
        ];
        
        const result = transformToChartData(transactions);
        
        expect(result).toEqual([
            { date: 'Jan 10', sales: 150, predicted: 165 }
        ]);
    });
});
```

---

### **Integration Tests:**

```javascript
// Test API endpoint
describe('GET /api/dashboard/sales-trend', () => {
    it('should return trend data', async () => {
        const res = await request(app)
            .get('/api/dashboard/sales-trend')
            .set('Authorization', `Bearer ${token}`);
        
        expect(res.status).toBe(200);
        expect(res.body.trendData).toBeInstanceOf(Array);
    });
});
```

---

## üìö Dependencies

### **Frontend:**

```json
{
  "recharts": "^2.x.x",  // Chart library
  "react": "^18.x.x",
  "lucide-react": "^0.x.x"  // Icons
}
```

### **Backend:**

```json
{
  "express": "^4.x.x",
  "mongoose": "^7.x.x"
}
```

---

## üéì Learning Resources

### **Recharts Documentation:**
- Official Docs: https://recharts.org/
- BarChart: https://recharts.org/en-US/api/BarChart
- Customization: https://recharts.org/en-US/guide/customize

### **MongoDB Aggregation:**
- Aggregation Pipeline: https://docs.mongodb.com/manual/aggregation/
- Date Operators: https://docs.mongodb.com/manual/reference/operator/aggregation/date/

---

## üìù Quick Reference

### **File Locations:**

```
Frontend:
‚îú‚îÄ‚îÄ src/pages/Dashboard.jsx (Lines 69-129)
‚îú‚îÄ‚îÄ src/hooks/useDashboardData.js (Lines 89-98)
‚îî‚îÄ‚îÄ src/utils/api.js

Backend:
‚îú‚îÄ‚îÄ routes/dashboard.js (Lines 94-129)
‚îî‚îÄ‚îÄ models/Transaction.js
```

### **Key Variables:**

| Variable | Type | Purpose |
|----------|------|---------|
| `chartData` | Array | Chart data points |
| `selectedDepot` | String | Current depot filter |
| `trendData` | Array | Backend response data |
| `transactions` | Array | Raw transaction records |

### **API Endpoints:**

```
GET /api/dashboard/sales-trend?days=7
GET /api/dashboard/sales-trend?days=30&depotId=123
```

---

## ‚úÖ Checklist for Changes

Before making changes, verify:

- [ ] Understand data flow (DB ‚Üí Backend ‚Üí Frontend ‚Üí Chart)
- [ ] Check data format matches expected structure
- [ ] Test with sample data first
- [ ] Verify CSS variables are defined
- [ ] Check browser console for errors
- [ ] Test with different depot filters
- [ ] Verify date ranges work correctly
- [ ] Check responsive behavior
- [ ] Test tooltip functionality
- [ ] Validate export buttons (if implemented)

---

## üöÄ Future Enhancements

### **Planned Features:**

1. **Real AI Predictions** - Replace mock 110% with actual ML model
2. **Multiple Time Ranges** - Add daily, monthly, yearly views
3. **Comparison Mode** - Compare multiple depots side-by-side
4. **Export Functionality** - Implement CSV/PDF export
5. **Drill-Down** - Click bar to see detailed transactions
6. **Forecasting** - Show future predictions beyond current data
7. **Anomaly Detection** - Highlight unusual patterns
8. **Custom Date Range** - Allow user to select specific dates

---

**Last Updated:** January 16, 2026  
**Version:** 1.0  
**Maintained By:** Development Team  
**Contact:** For questions, refer to this documentation or contact the dev team
